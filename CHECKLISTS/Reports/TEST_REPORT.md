# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ DatabaseManager

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –°–æ–∑–¥–∞–Ω TestDatabaseHelper
**–§–∞–π–ª:** `test/helpers/test_database_helper.dart`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFI –≤–µ—Ä—Å–∏–∏ SQLite –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
- –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω DatabaseManager
**–§–∞–π–ª:** `lib/src/data/database_manager.dart`

**–í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ custom database path –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è phrases –∏ user_data –±–∞–∑
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `reset()` –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

**–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
```dart
// –ü–æ–¥–¥–µ—Ä–∂–∫–∞ custom path –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
factory DatabaseManager({String? customDatabasePath}) => 
    _instance.._customPath = customDatabasePath;

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
static Database? _phrasesDb;
static Database? _userDataDb;

// –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –±–∞–∑
Future<void> close() async {
  if (_database != null) { await _database!.close(); _database = null; }
  if (_phrasesDb != null) { await _phrasesDb!.close(); _phrasesDb = null; }
  if (_userDataDb != null) { await _userDataDb!.close(); _userDataDb = null; }
}
```

### 3. –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
**–§–∞–π–ª:** `test/unit/data/database_manager_test.dart`

**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:**

#### üîß Singleton Pattern (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ singleton –ø–æ–≤–µ–¥–µ–Ω–∏—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ custom path –≤ singleton

#### üìä Main Database - dictionaries.db (7 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü (schema_info, words, word_cache)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã words
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã word_cache
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ (idx_word_lang, idx_frequency)
- ‚úÖ CHECK –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### üìù Phrases Database - phrases.db (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã —Ñ—Ä–∞–∑
- ‚úÖ Singleton –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è phrases DB
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (schema_info, phrases, phrase_cache)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑

#### üë§ User Data Database - user_data.db (6 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Singleton –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è user data DB
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (schema_info, user_corrections, translation_history, context_cache)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ user_corrections
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ translation_history
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ context_cache
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

#### üîç Database Integrity (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

#### üîÑ Database Closing and Cleanup (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ close()
- ‚úÖ –ü–æ–ª–Ω—ã–π reset –¥–ª—è —Ç–µ—Å—Ç–æ–≤

#### ‚ö†Ô∏è Error Handling (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ –û–±–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ DatabaseInitException
- ‚úÖ Concurrent –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è main database
- ‚úÖ Concurrent –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è phrases database
- ‚úÖ Concurrent –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è user database

#### üìÅ Custom Path Functionality (2 —Ç–µ—Å—Ç–∞)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –≤ custom –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

#### ‚ö° Performance and Data Insertion (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –º–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ (100 –∑–∞–ø–∏—Å–µ–π < 5 —Å–µ–∫)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫—ç—à-—Ç–∞–±–ª–∏—Ü

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
00:02 +39: All tests passed!
```

**–ò—Ç–æ–≥–æ:** 39 —Ç–µ—Å—Ç–æ–≤ ‚úÖ **–í–°–ï –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û**

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
test/
‚îú‚îÄ‚îÄ helpers/
‚îÇ   ‚îî‚îÄ‚îÄ test_database_helper.dart  # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ unit/
    ‚îî‚îÄ‚îÄ data/
        ‚îî‚îÄ‚îÄ database_manager_test.dart  # –ü–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã DatabaseManager
```

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–∞–∑—É
- **Cleanup**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- **FFI Support**: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –±–µ–∑ —ç–º—É–ª—è—Ç–æ—Ä–∞
- **Comprehensive Coverage**: –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏ edge cases
- **Performance Testing**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ bulk –æ–ø–µ—Ä–∞—Ü–∏–π

## üõ†Ô∏è –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Path Provider –≤ —Ç–µ—Å—Ç–∞—Ö** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ custom path
2. **Singleton –∏–∑–æ–ª—è—Ü–∏—è** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π reset –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏  
3. **Concurrent access** - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Memory leaks** - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
5. **Exception handling** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã**: –°–æ–±–ª—é–¥–µ–Ω—ã
- **Clean Code**: –ß–∏—Ç–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã —Å –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
- **Error Handling**: –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- **Performance**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Maintainability**: –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**  
**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:** 3  
**–¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã:** 39  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ